# Organization Subscription Management - Architecture Diagrams

## System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                         FRONTEND LAYER                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐ │
│  │  Admin Dashboard │  │  Member View     │  │  Purchase Wizard │ │
│  │  - Subscriptions │  │  - My Features   │  │  - Select Plan   │ │
│  │  - License Pools │  │  - Org Provided  │  │  - Configure     │ │
│  │  - Assignments   │  │  - Self Purchase │  │  - Payment       │ │
│  │  - Billing       │  │  - Usage Stats   │  │  - Confirmation  │ │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘ │
│                                                                       │
└───────────────────────────────┬───────────────────────────────────┘
                                │
                                │ REST API
                                │
┌───────────────────────────────┴───────────────────────────────────┐
│                         SERVICE LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │         Organization Subscription Service                     │ │
│  │  - Purchase subscriptions  - Calculate pricing               │ │
│  │  - Manage renewals        - Apply volume discounts           │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │         License Management Service                            │ │
│  │  - Create pools           - Assign licenses                  │ │
│  │  - Track utilization      - Transfer seats                   │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │         Entitlement Service                                   │ │
│  │  - Grant access           - Revoke access                    │ │
│  │  - Check permissions      - Sync entitlements                │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │         Billing Service                                       │ │
│  │  - Generate invoices      - Track payments                   │ │
│  │  - Cost projections       - Payment history                  │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │         Invitation Service                                    │ │
│  │  - Send invitations       - Track status                     │ │
│  │  - Auto-assign licenses   - Process acceptance               │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                       │
└───────────────────────────────┬───────────────────────────────────┘
                                │
                                │ SQL Queries
                                │
┌───────────────────────────────┴───────────────────────────────────┐
│                         DATA LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  EXISTING TABLES (Extended)          NEW TABLES                    │
│  ┌─────────────────────┐            ┌──────────────────────────┐ │
│  │ users               │            │ organization_            │ │
│  │ + school_id         │            │   subscriptions          │ │
│  │ + college_id        │            │ - org_id                 │ │
│  │ + role              │            │ - total_seats            │ │
│  └─────────────────────┘            │ - assigned_seats         │ │
│                                      │ - price_per_seat         │ │
│  ┌─────────────────────┐            └──────────────────────────┘ │
│  │ subscriptions       │                                          │
│  │ + organization_id   │            ┌──────────────────────────┐ │
│  │ + seat_count        │            │ license_pools            │ │
│  │ + purchased_by      │            │ - org_subscription_id    │ │
│  └─────────────────────┘            │ - allocated_seats        │ │
│                                      │ - member_type            │ │
│  ┌─────────────────────┐            └──────────────────────────┘ │
│  │ user_entitlements   │                                          │
│  │ + granted_by_org    │            ┌──────────────────────────┐ │
│  │ + org_sub_id        │            │ license_assignments      │ │
│  └─────────────────────┘            │ - user_id                │ │
│                                      │ - pool_id                │ │
│  ┌─────────────────────┐            │ - status                 │ │
│  │ payment_            │            └──────────────────────────┘ │
│  │   transactions      │                                          │
│  │ + organization_id   │            ┌──────────────────────────┐ │
│  │ + seat_count        │            │ organization_            │ │
│  └─────────────────────┘            │   invitations            │ │
│                                      │ - email                  │ │
│  ┌─────────────────────┐            │ - token                  │ │
│  │ subscription_plans  │            │ - auto_assign            │ │
│  │ (no changes)        │            └──────────────────────────┘ │
│  └─────────────────────┘                                          │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

## Purchase Flow Diagram

```
Admin                    UI                  Service              Payment           Database
  │                      │                      │                    │                 │
  │  1. Browse Plans     │                      │                    │                 │
  ├─────────────────────>│                      │                    │                 │
  │                      │  2. Get Plans        │                    │                 │
  │                      ├─────────────────────>│                    │                 │
  │                      │                      │  3. Query Plans    │                 │
  │                      │                      ├───────────────────>│                 │
  │                      │                      │<───────────────────┤                 │
  │                      │<─────────────────────┤                    │                 │
  │                      │                      │                    │                 │
  │  4. Select Plan      │                      │                    │                 │
  │  + Seat Count        │                      │                    │                 │
  ├─────────────────────>│                      │                    │                 │
  │                      │  5. Calculate Price  │                    │                 │
  │                      ├─────────────────────>│                    │                 │
  │                      │  (with discounts)    │                    │                 │
  │                      │<─────────────────────┤                    │                 │
  │                      │                      │                    │                 │
  │  6. Confirm Purchase │                      │                    │                 │
  ├─────────────────────>│                      │                    │                 │
  │                      │  7. Create Order     │                    │                 │
  │                      ├─────────────────────>│                    │                 │
  │                      │                      │  8. Razorpay Order │                 │
  │                      │                      ├───────────────────>│                 │
  │                      │                      │<───────────────────┤                 │
  │                      │<─────────────────────┤                    │                 │
  │                      │                      │                    │                 │
  │  9. Payment Gateway  │                      │                    │                 │
  │<─────────────────────┤                      │                    │                 │
  │                      │                      │                    │                 │
  │  10. Complete Payment│                      │                    │                 │
  ├──────────────────────┼──────────────────────┼───────────────────>│                 │
  │                      │                      │  11. Verify        │                 │
  │                      │                      │<───────────────────┤                 │
  │                      │                      │                    │                 │
  │                      │                      │  12. Create Org Subscription         │
  │                      │                      ├─────────────────────────────────────>│
  │                      │                      │                    │                 │
  │                      │                      │  13. Create License Pool             │
  │                      │                      ├─────────────────────────────────────>│
  │                      │                      │                    │                 │
  │                      │                      │  14. Record Payment│                 │
  │                      │                      ├─────────────────────────────────────>│
  │                      │                      │<─────────────────────────────────────┤
  │                      │                      │                    │                 │
  │  15. Success + Invoice                     │                    │                 │
  │<──────────────────────────────────────────┤                    │                 │
  │                      │                      │                    │                 │
```

## License Assignment Flow

```
Admin              License Service       Entitlement Service      Database
  │                      │                      │                     │
  │  1. View Available   │                      │                     │
  │     Seats            │                      │                     │
  ├─────────────────────>│                      │                     │
  │                      │  2. Query Pools      │                     │
  │                      ├─────────────────────────────────────────>│
  │                      │<─────────────────────────────────────────┤
  │<─────────────────────┤                      │                     │
  │                      │                      │                     │
  │  3. Assign to Member │                      │                     │
  ├─────────────────────>│                      │                     │
  │                      │  4. Check Available  │                     │
  │                      ├─────────────────────────────────────────>│
  │                      │<─────────────────────────────────────────┤
  │                      │                      │                     │
  │                      │  5. Create Assignment│                     │
  │                      ├─────────────────────────────────────────>│
  │                      │                      │                     │
  │                      │  6. Grant Entitlements                    │
  │                      ├─────────────────────>│                     │
  │                      │                      │  7. Create Entitlements
  │                      │                      ├────────────────────>│
  │                      │                      │<────────────────────┤
  │                      │<─────────────────────┤                     │
  │                      │                      │                     │
  │                      │  8. Update Seat Count│                     │
  │                      ├─────────────────────────────────────────>│
  │                      │<─────────────────────────────────────────┤
  │                      │                      │                     │
  │  9. Send Email to Member                    │                     │
  │<─────────────────────┤                      │                     │
  │                      │                      │                     │
  │  10. Success         │                      │                     │
  │<─────────────────────┤                      │                     │
  │                      │                      │                     │
```

## Member Invitation Flow

```
Admin          Invitation Service    Email Service    New Member    License Service
  │                   │                    │               │                │
  │  1. Send          │                    │               │                │
  │     Invitation    │                    │               │                │
  ├──────────────────>│                    │               │                │
  │                   │  2. Create Record  │               │                │
  │                   ├───────────────────────────────────────────────────>│
  │                   │                    │               │          Database
  │                   │                    │               │                │
  │                   │  3. Send Email     │               │                │
  │                   ├───────────────────>│               │                │
  │                   │                    │  4. Email     │                │
  │                   │                    ├──────────────>│                │
  │                   │                    │               │                │
  │                   │                    │  5. Click Link│                │
  │                   │<──────────────────────────────────┤                │
  │                   │                    │               │                │
  │                   │  6. Verify Token   │               │                │
  │                   ├───────────────────────────────────────────────────>│
  │                   │<───────────────────────────────────────────────────┤
  │                   │                    │               │                │
  │                   │  7. Link to Org    │               │                │
  │                   ├───────────────────────────────────────────────────>│
  │                   │                    │               │                │
  │                   │  8. Auto-Assign?   │               │                │
  │                   ├──────────────────────────────────────────────────>│
  │                   │                    │               │  License Service
  │                   │                    │               │                │
  │                   │  9. Grant Access   │               │                │
  │                   │<──────────────────────────────────────────────────┤
  │                   │                    │               │                │
  │                   │  10. Welcome Email │               │                │
  │                   ├───────────────────>│               │                │
  │                   │                    ├──────────────>│                │
  │                   │                    │               │                │
  │  11. Notify Admin │                    │               │                │
  │<──────────────────┤                    │               │                │
  │                   │                    │               │                │
```

## Data Model Relationships

```
┌─────────────────────────────────────────────────────────────────────┐
│                     ORGANIZATION HIERARCHY                           │
└─────────────────────────────────────────────────────────────────────┘

                    ┌──────────────┐
                    │ Organization │
                    │ (School/     │
                    │  College/    │
                    │  University) │
                    └──────┬───────┘
                           │
                           │ has
                           │
            ┌──────────────┴──────────────┐
            │                             │
            ▼                             ▼
    ┌───────────────┐            ┌───────────────┐
    │ Organization  │            │    Users      │
    │ Subscriptions │            │  (Members)    │
    └───────┬───────┘            └───────┬───────┘
            │                            │
            │ creates                    │ belongs to
            │                            │
            ▼                            │
    ┌───────────────┐                   │
    │ License Pools │                   │
    └───────┬───────┘                   │
            │                            │
            │ contains                   │
            │                            │
            ▼                            │
    ┌───────────────┐                   │
    │   License     │◄──────────────────┘
    │  Assignments  │    assigned to
    └───────┬───────┘
            │
            │ grants
            │
            ▼
    ┌───────────────┐
    │     User      │
    │ Entitlements  │
    └───────────────┘
```

## Seat Utilization Dashboard

```
┌─────────────────────────────────────────────────────────────────────┐
│                    ORGANIZATION DASHBOARD                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  Active Subscriptions                                                │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Professional Plan - Educators                                │   │
│  │ ████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 45/100 │   │
│  │ Expires: Dec 31, 2026                                        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Basic Plan - Students                                        │   │
│  │ ████████████████████████████████████████████████░░░░ 450/500 │   │
│  │ Expires: Dec 31, 2026                                        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  Monthly Cost Breakdown                                              │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Subscriptions:        ₹45,000                                │   │
│  │ Add-ons:              ₹12,000                                │   │
│  │ ─────────────────────────────                                │   │
│  │ Total:                ₹57,000                                │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  Quick Actions                                                       │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐              │
│  │  Add Seats   │ │ Assign       │ │ View         │              │
│  │              │ │ Licenses     │ │ Billing      │              │
│  └──────────────┘ └──────────────┘ └──────────────┘              │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

## Volume Discount Visualization

```
Pricing per Seat (₹250 base price)

₹250 ┤                                                    
     │ ████████████                                      
₹225 ┤ ████████████ ████████████                        
     │ ████████████ ████████████                        
₹200 ┤ ████████████ ████████████ ████████████          
     │ ████████████ ████████████ ████████████          
₹175 ┤ ████████████ ████████████ ████████████ ████████
     │ ████████████ ████████████ ████████████ ████████
     └─────────────┬─────────────┬─────────────┬────────
                1-49          50-99        100-499    500+
                 0%            10%           20%       30%
                              Discount
```

## Security & Access Control

```
┌─────────────────────────────────────────────────────────────────────┐
│                     ACCESS CONTROL MATRIX                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  Role              │ Purchase │ Assign │ View    │ Manage  │ Revoke │
│                    │ Subs     │ Seats  │ Members │ Billing │ Access │
│  ──────────────────┼──────────┼────────┼─────────┼─────────┼────────┤
│  Super Admin       │    ✓     │   ✓    │    ✓    │    ✓    │   ✓    │
│  University Admin  │    ✓     │   ✓    │    ✓    │    ✓    │   ✓    │
│  College Admin     │    ✓     │   ✓    │    ✓    │    ✓    │   ✓    │
│  School Admin      │    ✓     │   ✓    │    ✓    │    ✓    │   ✓    │
│  Educator          │    ✗     │   ✗    │    ✗    │    ✗    │   ✗    │
│  Student           │    ✗     │   ✗    │    ✗    │    ✗    │   ✗    │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘

Row-Level Security (RLS) Policies:
- Admins can only access their organization's data
- Members can only view their own entitlements
- Cross-organization access is blocked
- Audit logs track all admin actions
```

## Monitoring Dashboard

```
┌─────────────────────────────────────────────────────────────────────┐
│                     SYSTEM HEALTH DASHBOARD                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  API Response Time (p95)                                             │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 150ms ████████████████████████████████░░░░░░░░░░░░░░ Target │   │
│  │                                                      200ms   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  Seat Utilization                                                    │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 87% ████████████████████████████████████████████░░░░ Target │   │
│  │                                                       90%    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  Payment Success Rate                                                │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 99.8% ████████████████████████████████████████████████████  │   │
│  │                                                      Target  │   │
│  │                                                      99.9%   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  Active Alerts: 0                                                    │
│  Last Incident: None (30 days uptime)                                │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

---

**Document Version**: 1.0  
**Last Updated**: January 2026

