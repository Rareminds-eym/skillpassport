name = "payments-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
account_id = "8c79b0992cfe6e720d17d0a2394ef0fd"

[vars]
ENVIRONMENT = "production"
STORAGE_API_URL = "https://storage-api.dark-mode-d021.workers.dev"

# Cron trigger for entitlement lifecycle processing
# Runs daily at 6:00 AM UTC to:
# - Process auto-renewals for expiring entitlements
# - Mark expired entitlements as 'expired'
# - Send renewal reminder emails (7, 3, 1 days before expiry)
[triggers]
crons = ["0 6 * * *"]

# Service binding to email-api worker
[[services]]
binding = "EMAIL_SERVICE"
service = "email-api"

# Service binding to storage-api worker (for worker-to-worker communication)
# [[services]]
# binding = "STORAGE_SERVICE"
# service = "storage-api"

# =============================================================================
# REQUIRED SECRETS - Set via Cloudflare Dashboard or wrangler CLI
# =============================================================================
# Run these commands to set secrets:
#   wrangler secret put SUPABASE_URL
#   wrangler secret put SUPABASE_ANON_KEY
#   wrangler secret put SUPABASE_SERVICE_ROLE_KEY
#   wrangler secret put RAZORPAY_KEY_ID
#   wrangler secret put RAZORPAY_KEY_SECRET
#
# Optional secrets:
#   wrangler secret put RAZORPAY_WEBHOOK_SECRET
#   wrangler secret put TEST_RAZORPAY_KEY_ID
#   wrangler secret put TEST_RAZORPAY_KEY_SECRET
#
# For local development, copy .dev.vars.example to .dev.vars
# =============================================================================